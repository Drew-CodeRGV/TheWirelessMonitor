{% extends "base.html" %}

{% block title %}RSS Feeds - The Wireless Monitor{% endblock %}

{% block content %}
<h2>üì° RSS Feed Management</h2>

<div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 25px; margin-top: 35px;">
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border: 2px solid #e9ecef;">
        <h3 style="margin-bottom: 20px; color: #2c3e50;">Add Single RSS Feed</h3>
        <form method="POST" action="{{ url_for('add_feed', view=view_mode) }}">
            <div class="form-group">
                <label for="name">Feed Name:</label>
                <input type="text" id="name" name="name" required placeholder="e.g., TechCrunch">
            </div>
            <div class="form-group">
                <label for="url">RSS URL:</label>
                <input type="url" id="url" name="url" required placeholder="https://example.com/feed.xml">
            </div>
            <button type="submit" class="btn">‚ûï Add Feed</button>
        </form>
    </div>
    
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border: 2px solid #e9ecef;">
        <h3 style="margin-bottom: 20px; color: #2c3e50;">Google News by Keyword</h3>
        <form method="POST" action="{{ url_for('add_google_news', view=view_mode) }}">
            <div class="form-group">
                <label for="keyword">Search Keyword:</label>
                <input type="text" id="keyword" name="keyword" required placeholder="e.g., 5G, WiFi 6, IoT">
            </div>
            <div style="font-size: 0.85rem; color: #7f8c8d; margin-bottom: 15px; font-family: 'Inter', sans-serif;">
                Creates: Google News: [keyword]<br>
                URL: news.google.com/rss/search?q=[keyword]
            </div>
            <button type="submit" class="btn" style="background: #4285f4;">üîç Add Google News</button>
        </form>
    </div>
    
    <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; border: 2px solid #e9ecef;">
        <h3 style="margin-bottom: 20px; color: #2c3e50;">Bulk Import RSS Feeds</h3>
        <form method="POST" action="{{ url_for('bulk_import', view=view_mode) }}">
            <div class="form-group">
                <label for="urls">RSS URLs (one per line):</label>
                <textarea id="urls" name="urls" rows="4" placeholder="https://example1.com/feed.xml
https://example2.com/rss"></textarea>
            </div>
            <button type="submit" class="btn">üì• Bulk Import</button>
        </form>
        <p style="font-size: 0.85rem; color: #7f8c8d; margin-top: 12px; font-family: 'Inter', sans-serif;">
            Feed names auto-detected
        </p>
    </div>
</div>

<div style="margin-top: 35px; background: #f8f9fa; padding: 25px; border-radius: 10px; border: 2px solid #e9ecef;">
    <h3 style="margin-bottom: 20px; color: #2c3e50;">Quick Add Suggestions</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
        <div>
            <p style="margin-bottom: 15px; font-family: 'Inter', sans-serif; color: #34495e; font-weight: 600;">Wireless Technology Feeds:</p>
            <div style="font-size: 0.9rem; line-height: 1.8; font-family: 'Inter', sans-serif; color: #2c3e50;">
                <strong>Wi-Fi Alliance:</strong> https://www.wi-fi.org/news-events/newsroom/rss<br>
                <strong>Wireless Week:</strong> https://www.wirelessweek.com/rss.xml<br>
                <strong>RCR Wireless:</strong> https://www.rcrwireless.com/feed<br>
                <strong>Light Reading:</strong> https://www.lightreading.com/rss_simple.asp<br>
                <strong>Mobile World Live:</strong> https://www.mobileworldlive.com/feed/<br>
            </div>
        </div>
        <div>
            <p style="margin-bottom: 15px; font-family: 'Inter', sans-serif; color: #34495e; font-weight: 600;">Popular Google News Keywords:</p>
            <div style="font-size: 0.9rem; line-height: 1.8; font-family: 'Inter', sans-serif; color: #2c3e50;">
                <strong>Wireless:</strong> "5G", "WiFi 6", "wireless technology"<br>
                <strong>IoT:</strong> "Internet of Things", "smart home", "IoT security"<br>
                <strong>Mobile:</strong> "smartphone", "mobile network", "cellular"<br>
                <strong>Tech:</strong> "wireless charging", "Bluetooth", "NFC"<br>
            </div>
        </div>
    </div>
</div>

<h3 style="margin-top: 45px; margin-bottom: 25px;">Current RSS Feeds</h3>

{% if feeds %}
<div id="verification-status" style="margin-bottom: 20px;"></div>

<div style="margin-top: 25px;">
    {% for feed in feeds %}
    <div class="article" style="display: flex; justify-content: space-between; align-items: center; background: #fafafa; padding: 20px; border-radius: 8px; border: 1px solid #e9ecef;" id="feed-{{ feed.id }}">
        <div style="flex: 1;">
            <h4 style="margin-bottom: 8px; font-family: 'Inter', sans-serif; font-weight: 600;">
                {% if feed.active %}
                    <span style="color: #27ae60;">‚úÖ</span> 
                {% else %}
                    <span style="color: #e74c3c;">‚ùå</span> 
                {% endif %}
                {{ feed.name }}
                {% if not feed.active %}
                    <span style="color: #7f8c8d; font-weight: 400;">(Disabled)</span>
                {% endif %}
                {% if 'news.google.com' in feed.url %}
                    <span style="background: #4285f4; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.7rem; margin-left: 8px;">Google News</span>
                {% endif %}
            </h4>
            <div style="font-size: 0.9rem; color: #7f8c8d; font-family: 'Inter', sans-serif; line-height: 1.5;">
                <strong>URL:</strong> <span style="word-break: break-all;">{{ feed.url }}</span><br>
                <strong>Last Fetched:</strong> {{ feed.last_fetched or 'Never' }}
            </div>
            <div id="feed-status-{{ feed.id }}" style="margin-top: 8px;"></div>
        </div>
        <div style="margin-left: 20px; display: flex; gap: 10px;">
            <button onclick="verifyFeed({{ feed.id }})" class="btn" style="background: #17a2b8; font-size: 0.8rem; padding: 6px 12px;">üîç Verify</button>
            <a href="{{ url_for('toggle_feed', feed_id=feed.id, view=view_mode) }}" 
               class="btn {% if feed.active %}btn-danger{% endif %}" 
               style="white-space: nowrap; font-size: 0.8rem; padding: 6px 12px;">
                {% if feed.active %}üîá Disable{% else %}üîä Enable{% endif %}
            </a>
        </div>
    </div>
    {% endfor %}
</div>

<script>
async function verifyFeed(feedId) {
    const statusDiv = document.getElementById(`feed-status-${feedId}`);
    const button = event.target;
    
    button.disabled = true;
    button.textContent = '‚è≥ Checking...';
    statusDiv.innerHTML = '<div style="font-size: 0.8rem; color: #17a2b8; padding: 5px 0;">üîç Verifying RSS feed...</div>';
    
    try {
        const response = await fetch(`/api/verify_feed/${feedId}`);
        const data = await response.json();
        
        if (data.success) {
            statusDiv.innerHTML = `
                <div style="font-size: 0.8rem; color: #27ae60; padding: 5px 0; background: #d4edda; padding: 8px; border-radius: 4px; border-left: 3px solid #27ae60;">
                    ‚úÖ <strong>Feed Working:</strong> ${data.entries_count} entries found<br>
                    üì∞ <strong>Title:</strong> ${data.title}<br>
                    üïí <strong>Last Updated:</strong> ${data.last_updated}
                </div>
            `;
        } else {
            statusDiv.innerHTML = `
                <div style="font-size: 0.8rem; color: #e74c3c; padding: 5px 0; background: #f8d7da; padding: 8px; border-radius: 4px; border-left: 3px solid #e74c3c;">
                    ‚ùå <strong>Feed Error:</strong> ${data.error}
                </div>
            `;
        }
    } catch (error) {
        statusDiv.innerHTML = `
            <div style="font-size: 0.8rem; color: #e74c3c; padding: 5px 0; background: #f8d7da; padding: 8px; border-radius: 4px; border-left: 3px solid #e74c3c;">
                ‚ùå <strong>Network Error:</strong> ${error.message}
            </div>
        `;
    } finally {
        button.disabled = false;
        button.textContent = 'üîç Verify';
    }
}
</script>
{% else %}
<div style="text-align: center; padding: 60px 20px; color: #7f8c8d; background: #f8f9fa; border-radius: 10px; border: 2px dashed #dee2e6;">
    <h3 style="font-family: 'Times New Roman', serif; font-size: 2rem; margin-bottom: 15px; color: #2c3e50;">üì° No RSS Feeds Configured</h3>
    <p style="font-family: 'Inter', sans-serif; font-size: 1.1rem;">Add your first RSS feed using the forms above</p>
</div>
{% endif %}

{% endblock %}