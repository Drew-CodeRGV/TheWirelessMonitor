{% extends "base.html" %}

{% block title %}The Wireless Monitor - Today's Headlines{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h2>ğŸ“° Today's Wireless Technology Headlines</h2>
    <button onclick="fetchNow()" class="btn">ğŸ”„ Fetch Now</button>
</div>

<div id="fetch-status" style="margin-bottom: 20px;"></div>

{% if stories %}
    {% for story in stories %}
    <div class="article">
        <h3><a href="{{ story.url }}" target="_blank">{{ story.title }}</a></h3>
        <div class="article-meta">
            Published: {{ story.published_date[:16] }}
            <span class="relevance-score">{{ "%.0f"|format(story.relevance_score * 100) }}% Relevant</span>
        </div>
        <p>{{ story.description[:300] }}{% if story.description|length > 300 %}...{% endif %}</p>
    </div>
    {% endfor %}
{% else %}
    <div style="text-align: center; padding: 50px; color: #666;">
        <h3>ğŸ“¡ No stories found for today</h3>
        <p>Click "Fetch Now" to get the latest wireless technology news</p>
        <button onclick="fetchNow()" class="btn" style="margin-top: 20px;">ğŸ”„ Fetch RSS Feeds</button>
    </div>
{% endif %}

<script>
async function fetchNow() {
    const statusDiv = document.getElementById('fetch-status');
    const button = event.target;
    
    button.disabled = true;
    button.textContent = 'â³ Fetching...';
    statusDiv.innerHTML = '<div class="alert alert-success">ğŸ“¡ Fetching RSS feeds, please wait...</div>';
    
    try {
        const response = await fetch('/api/fetch_now');
        const data = await response.json();
        
        if (data.success) {
            statusDiv.innerHTML = `<div class="alert alert-success">âœ… Successfully fetched ${data.fetched} new articles! Refreshing page...</div>`;
            setTimeout(() => location.reload(), 2000);
        } else {
            statusDiv.innerHTML = `<div class="alert alert-error">âŒ Error: ${data.error}</div>`;
        }
    } catch (error) {
        statusDiv.innerHTML = `<div class="alert alert-error">âŒ Network error: ${error.message}</div>`;
    } finally {
        button.disabled = false;
        button.textContent = 'ğŸ”„ Fetch Now';
    }
}
</script>
{% endblock %}