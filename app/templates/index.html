{% extends "base.html" %}

{% block title %}The Wireless Monitor - Today's Headlines{% endblock %}

{% block content %}
{% if view_mode == 'reader' %}
    <!-- Google Reader Style Three-Pane Layout -->
    <div class="reader-layout">
        <!-- Feeds Pane -->
        <div class="feeds-pane">
            <h3>üì° RSS Feeds</h3>
            <ul class="feed-list">
                <li class="feed-item active">All Items ({{ total_articles }})</li>
                <li class="feed-item">Starred Items</li>
                <li class="feed-item">Shared Items</li>
                <li class="feed-item">---</li>
                <li class="feed-item">Ars Technica</li>
                <li class="feed-item">TechCrunch</li>
                <li class="feed-item">The Verge</li>
                <li class="feed-item">IEEE Spectrum</li>
                <li class="feed-item">Fierce Wireless</li>
                <li class="feed-item">RCR Wireless</li>
            </ul>
        </div>
        
        <!-- Articles List Pane -->
        <div class="articles-pane">
            <h3>üì∞ Headlines ({{ stories|length }})</h3>
            {% if stories %}
                {% for story in stories %}
                <div class="article-list-item" onclick="selectArticle({{ loop.index0 }})">
                    <h4>{{ story.title }}</h4>
                    <div class="snippet">{{ (story.description[:120] + '...') if story.description and story.description|length > 120 else (story.description or 'No preview available') }}</div>
                    <div class="meta">
                        <span>{{ story.feed_name }}</span>
                        <span>{{ story.published_date[:10] }}</span>
                        {% if story.event_name %}
                        <span style="background: #9c27b0; color: white; padding: 1px 4px; border-radius: 4px; font-size: 0.6rem; font-weight: 600;">üé™ {{ story.event_name }}</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="padding: 40px 20px; text-align: center; color: #666;">
                    <p>No articles available</p>
                    <button onclick="fetchNow()" class="btn">üîÑ Fetch Now</button>
                </div>
            {% endif %}
        </div>
        
        <!-- Article Preview Pane -->
        <div class="article-preview">
            <div id="article-content">
                <h2>Select an article to preview</h2>
                <p style="color: #666; margin-top: 20px;">Click on any article from the list to see its full content here.</p>
            </div>
        </div>
    </div>
    
    <script>
        const articles = {{ stories|tojson }};
        
        function selectArticle(index) {
            // Remove previous selection
            document.querySelectorAll('.article-list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            document.querySelectorAll('.article-list-item')[index].classList.add('selected');
            
            // Update preview pane
            const article = articles[index];
            const previewPane = document.getElementById('article-content');
            
            previewPane.innerHTML = `
                <h2>${article.title}</h2>
                <div class="preview-meta">
                    <strong>Source:</strong> ${article.feed_name} | 
                    <strong>Published:</strong> ${article.published_date.substring(0, 16)} | 
                    <strong>Relevance:</strong> ${Math.round(article.relevance_score * 100)}%
                </div>
                <div class="content">
                    ${article.content || article.description || 'No content available'}
                    <br><br>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="shareArticle(${article.id})" class="btn" style="background: #1da1f2; font-size: 0.85rem; padding: 6px 12px;">
                            üì§ Share
                        </button>
                        <button onclick="addToDigest(${article.id})" class="btn" style="background: #ff6b35; font-size: 0.85rem; padding: 6px 12px;">
                            üìã Add to Digest
                        </button>
                        <a href="${article.url}" target="_blank" class="btn">üìñ Read Full Article</a>
                    </div>
                </div>
            `;
        }
        
        async function fetchNow() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Fetching...';
            
            try {
                const response = await fetch('/api/fetch_now');
                const data = await response.json();
                
                if (data.success) {
                    setTimeout(() => location.reload(), 1000);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'üîÑ Fetch Now';
            }
        }
    </script>

{% else %}
    <!-- NY Magazine Style Newspaper Layout -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px;">
        <h2>üì∞ Latest Wireless Technology Headlines</h2>
        <div style="display: flex; gap: 10px;">
            {% if not show_all and total_articles > relevant_articles %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" class="btn" style="background: #27ae60;">üìã Show All ({{ total_articles }})</a>
            {% elif show_all %}
                <a href="{{ url_for('index', view=view_mode) }}" class="btn" style="background: #f39c12;">üéØ Show Relevant Only ({{ relevant_articles }})</a>
            {% elif total_articles > 12 %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" class="btn" style="background: #27ae60;">üìã Show All ({{ total_articles }})</a>
            {% endif %}
            <button onclick="fetchNow()" class="btn">üîÑ Fetch Now</button>
        </div>
    </div>

    {% if show_all and stories %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #f39c12;">
        <p style="font-family: 'Inter', sans-serif; font-size: 0.9rem; color: #856404; margin: 0;">
            <strong>üìã Showing all {{ stories|length }} articles from the last 5 days</strong> - including lower relevance items. 
            <a href="{{ url_for('index', view=view_mode) }}" style="color: #856404; text-decoration: underline;">Show relevant only ({{ relevant_articles }})</a>
        </p>
    </div>
    {% elif not show_all and stories %}
    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #27ae60;">
        <p style="font-family: 'Inter', sans-serif; font-size: 0.9rem; color: #2d5a2d; margin: 0;">
            <strong>üéØ Showing {{ stories|length }} most relevant articles</strong> from the last 3-5 days. 
            {% if total_articles > relevant_articles %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" style="color: #2d5a2d; text-decoration: underline;">Show all {{ total_articles }} articles</a>
            {% endif %}
        </p>
    </div>
    {% endif %}

    <div id="fetch-status" style="margin-bottom: 25px;"></div>

    {% if stories %}
        <!-- Al Jazeera Style Layout: Hero Story + Two Top Stories Columns -->
        <div class="hero-layout" style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 30px; margin-bottom: 40px;">
            <!-- Left: Hero Story (Al Jazeera Style) -->
            <div class="hero-section">
                {% set hero_article = stories[0] %}
                <article class="hero-article" style="position: relative;">
                    <!-- Hero Image -->
                    <div class="hero-image" style="position: relative; margin-bottom: 20px;">
                        {% if hero_article.image_url %}
                            <img src="{{ hero_article.image_url }}" alt="{{ hero_article.title }}" 
                                 style="width: 100%; height: 400px; object-fit: cover; border-radius: 0;">
                        {% else %}
                            <div class="hero-image-placeholder" data-article-id="{{ hero_article.id }}" style="width: 100%; height: 400px; background: linear-gradient(135deg, #2c3e50, #34495e); border-radius: 0; display: flex; align-items: center; justify-content: center; flex-direction: column; transition: all 0.3s ease;" 
                                 onclick="generateArticleImage({{ hero_article.id }}, this)">
                                <div style="text-align: center; color: white;">
                                    <div style="font-size: 3rem; margin-bottom: 15px;">üé®</div>
                                    <div style="font-family: 'Inter', sans-serif; font-size: 1.2rem; font-weight: 600; margin-bottom: 8px;">Generate Hero Image</div>
                                    <div style="font-family: 'Inter', sans-serif; font-size: 1rem; margin-bottom: 10px;">Professional news-style imagery</div>
                                    <div style="font-family: 'Inter', sans-serif; font-size: 0.9rem; opacity: 0.8;">Click to generate</div>
                                </div>
                            </div>
                        {% endif %}
                        
                        <!-- Category Badge (Al Jazeera Style) -->
                        <div style="position: absolute; top: 15px; left: 15px;">
                            {% if hero_article.event_name %}
                                <span style="background: #9c27b0; color: white; padding: 6px 12px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                    üé™ {{ hero_article.event_name }}
                                </span>
                            {% else %}
                                <span style="background: #e52d27; color: white; padding: 6px 12px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">
                                    WIRELESS TECH
                                </span>
                            {% endif %}
                        </div>
                        
                        <!-- Relevance Score Badge -->
                        <div style="position: absolute; top: 15px; right: 15px;">
                            <span style="{% if hero_article.relevance_score < 0.3 %}background: #e74c3c;{% elif hero_article.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %} color: white; padding: 4px 8px; font-size: 0.7rem; font-weight: 600; border-radius: 3px;">
                                {{ "%.0f"|format(hero_article.relevance_score * 100) }}%
                            </span>
                        </div>
                    </div>
                    
                    <!-- Hero Content -->
                    <div class="hero-content">
                        <div class="hero-meta" style="margin-bottom: 12px; font-size: 0.85rem; color: #7f8c8d; font-family: 'Inter', sans-serif; font-weight: 500;">
                            {% set icon, color = get_feed_icon(hero_article.feed_name, hero_article.feed_url) %}
                            <span style="color: {{ color }};">{{ icon }}</span>
                            {{ hero_article.feed_name }} ‚Ä¢ {{ hero_article.published_date[:16] }}
                        </div>
                        
                        <h1 style="font-family: 'Playfair Display', serif; font-size: 2.2rem; font-weight: 700; line-height: 1.2; margin-bottom: 15px; color: #2c3e50;">
                            <a href="{{ hero_article.url }}" target="_blank" style="color: inherit; text-decoration: none;">{{ hero_article.title }}</a>
                        </h1>
                        
                        {% if hero_article.content and hero_article.content|length > 100 %}
                            <p style="font-size: 1.1rem; line-height: 1.6; color: #555; margin-bottom: 20px; font-family: 'Inter', sans-serif;">
                                {{ hero_article.content[:300] }}{% if hero_article.content|length > 300 %}...{% endif %}
                            </p>
                        {% elif hero_article.description %}
                            <p style="font-size: 1.1rem; line-height: 1.6; color: #555; margin-bottom: 20px; font-family: 'Inter', sans-serif;">
                                {{ hero_article.description[:280] }}{% if hero_article.description|length > 280 %}...{% endif %}
                            </p>
                        {% endif %}
                        
                        <!-- Hero Actions -->
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <a href="{{ hero_article.url }}" target="_blank" class="btn" style="background: #2c3e50; color: white; font-size: 0.9rem; padding: 10px 20px; text-decoration: none; font-weight: 600;">
                                Read Full Story
                            </a>
                            <button onclick="shareArticle({{ hero_article.id }})" class="btn" style="background: #1da1f2; font-size: 0.85rem; padding: 8px 16px;">
                                üì§ Share
                            </button>
                            <button onclick="addToDigest({{ hero_article.id }})" class="btn" style="background: #ff6b35; font-size: 0.85rem; padding: 8px 16px;">
                                üìã Digest
                            </button>
                        </div>
                    </div>
                </article>
            </div>
            
            <!-- Middle: Top Stories Column 1 -->
            <div class="top-stories-col-1">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; margin-bottom: 20px; color: #2c3e50; border-bottom: 2px solid #e52d27; padding-bottom: 8px;">
                    üì∞ Top Stories
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    {% set secondary_stories = [] %}
                    {% for story in stories[1:] %}
                        {% if not story.event_name and secondary_stories|length < 20 %}
                            {% set _ = secondary_stories.append(story) %}
                        {% endif %}
                    {% endfor %}
                    
                    {% for story in secondary_stories[:4] %}
                        <article class="secondary-story" style="display: flex; flex-direction: column; gap: 12px; padding-bottom: 20px; {% if not loop.last %}border-bottom: 1px solid #e1e5e9;{% endif %}">
                            <!-- Story Image -->
                            <div style="width: 100%;">
                                {% if story.image_url %}
                                    <img src="{{ story.image_url }}" alt="{{ story.title }}" 
                                         style="width: 100%; height: 140px; object-fit: cover; border-radius: 0;">
                                {% else %}
                                    <div data-article-id="{{ story.id }}" class="secondary-image-placeholder" style="width: 100%; height: 140px; background: linear-gradient(135deg, #ecf0f1, #bdc3c7); border-radius: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; color: #7f8c8d; text-align: center; font-weight: 600;" 
                                         onclick="generateArticleImage({{ story.id }}, this)">
                                        üì∏<br>Generate
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Story Content -->
                            <div style="flex: 1;">
                                <div style="margin-bottom: 8px; font-size: 0.7rem; color: #7f8c8d; font-family: 'Inter', sans-serif; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">
                                    {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                                    <span style="color: {{ color }};">{{ icon }}</span>
                                    {{ story.feed_name }} ‚Ä¢ {{ story.published_date[:10] }}
                                </div>
                                
                                <h3 style="font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 600; line-height: 1.3; margin-bottom: 8px; color: #2c3e50;">
                                    <a href="{{ story.url }}" target="_blank" style="color: inherit; text-decoration: none;">{{ story.title }}</a>
                                </h3>
                                
                                {% if story.description %}
                                    <p style="font-size: 0.8rem; line-height: 1.4; color: #666; margin-bottom: 12px; font-family: 'Inter', sans-serif;">
                                        {{ story.description[:100] }}{% if story.description|length > 100 %}...{% endif %}
                                    </p>
                                {% endif %}
                                
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %} color: white; padding: 3px 6px; font-size: 0.65rem; font-weight: 600; border-radius: 3px;">
                                        {{ "%.0f"|format(story.relevance_score * 100) }}%
                                    </span>
                                    <div style="display: flex; gap: 4px;">
                                        <button onclick="shareArticle({{ story.id }})" class="btn" style="background: #1da1f2; font-size: 0.65rem; padding: 3px 6px;">üì§</button>
                                        <button onclick="addToDigest({{ story.id }})" class="btn" style="background: #ff6b35; font-size: 0.65rem; padding: 3px 6px;">üìã</button>
                                    </div>
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
                
                <!-- More Stories Link -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e52d27;">
                    <a href="#more-stories" onclick="document.getElementById('more-stories').scrollIntoView({behavior: 'smooth'})" 
                       style="display: flex; align-items: center; justify-content: space-between; color: #2c3e50; text-decoration: none; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.8rem; padding: 8px 0;">
                        <span>More News</span>
                        <span style="font-size: 1rem;">‚Üí</span>
                    </a>
                </div>
            </div>
            
            <!-- Right: Top Stories Column 2 -->
            <div class="top-stories-col-2">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 1.3rem; font-weight: 700; margin-bottom: 20px; color: #2c3e50; border-bottom: 2px solid #e52d27; padding-bottom: 8px;">
                    üì∞ Top Stories
                </h3>
                
                <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    {% for story in secondary_stories[4:8] %}
                        <article class="secondary-story" style="display: flex; flex-direction: column; gap: 12px; padding-bottom: 20px; {% if not loop.last %}border-bottom: 1px solid #e1e5e9;{% endif %}">
                            <!-- Story Image -->
                            <div style="width: 100%;">
                                {% if story.image_url %}
                                    <img src="{{ story.image_url }}" alt="{{ story.title }}" 
                                         style="width: 100%; height: 140px; object-fit: cover; border-radius: 0;">
                                {% else %}
                                    <div data-article-id="{{ story.id }}" class="secondary-image-placeholder" style="width: 100%; height: 140px; background: linear-gradient(135deg, #ecf0f1, #bdc3c7); border-radius: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; color: #7f8c8d; text-align: center; font-weight: 600;" 
                                         onclick="generateArticleImage({{ story.id }}, this)">
                                        üì∏<br>Generate
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Story Content -->
                            <div style="flex: 1;">
                                <div style="margin-bottom: 8px; font-size: 0.7rem; color: #7f8c8d; font-family: 'Inter', sans-serif; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px;">
                                    {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                                    <span style="color: {{ color }};">{{ icon }}</span>
                                    {{ story.feed_name }} ‚Ä¢ {{ story.published_date[:10] }}
                                </div>
                                
                                <h3 style="font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 600; line-height: 1.3; margin-bottom: 8px; color: #2c3e50;">
                                    <a href="{{ story.url }}" target="_blank" style="color: inherit; text-decoration: none;">{{ story.title }}</a>
                                </h3>
                                
                                {% if story.description %}
                                    <p style="font-size: 0.8rem; line-height: 1.4; color: #666; margin-bottom: 12px; font-family: 'Inter', sans-serif;">
                                        {{ story.description[:100] }}{% if story.description|length > 100 %}...{% endif %}
                                    </p>
                                {% endif %}
                                
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %} color: white; padding: 3px 6px; font-size: 0.65rem; font-weight: 600; border-radius: 3px;">
                                        {{ "%.0f"|format(story.relevance_score * 100) }}%
                                    </span>
                                    <div style="display: flex; gap: 4px;">
                                        <button onclick="shareArticle({{ story.id }})" class="btn" style="background: #1da1f2; font-size: 0.65rem; padding: 3px 6px;">üì§</button>
                                        <button onclick="addToDigest({{ story.id }})" class="btn" style="background: #ff6b35; font-size: 0.65rem; padding: 3px 6px;">üìã</button>
                                    </div>
                                </div>
                            </div>
                        </article>
                    {% endfor %}
                </div>
                
                <!-- More Stories Link -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e52d27;">
                    <a href="#more-stories" onclick="document.getElementById('more-stories').scrollIntoView({behavior: 'smooth'})" 
                       style="display: flex; align-items: center; justify-content: space-between; color: #2c3e50; text-decoration: none; font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.8rem; padding: 8px 0;">
                        <span>More News</span>
                        <span style="font-size: 1rem;">‚Üí</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Event Coverage Row (Between Headlines and More Stories) -->
        {% set event_articles = [] %}
        {% for story in stories %}
            {% if story.event_name %}
                {% set _ = event_articles.append(story) %}
            {% endif %}
        {% endfor %}
        
        {% if event_articles %}
        <div style="background: linear-gradient(135deg, #f8f4ff, #f0ebff); border: 2px solid #9c27b0; border-radius: 12px; padding: 25px; margin-bottom: 40px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h3 style="font-family: 'Playfair Display', serif; font-size: 1.8rem; color: #9c27b0; margin: 0; display: flex; align-items: center; gap: 10px;">
                    üé™ Event Coverage
                    <span style="font-size: 0.8rem; background: #9c27b0; color: white; padding: 3px 10px; border-radius: 15px; font-weight: 600;">LIVE</span>
                </h3>
                <a href="{{ url_for('events', view=view_mode) }}" class="btn" style="background: #9c27b0; font-size: 0.85rem; padding: 8px 16px;">
                    View All Events
                </a>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                {% for event_story in event_articles[:6] %}
                    <article class="event-article" style="background: rgba(255,255,255,0.7); border-radius: 8px; padding: 15px; border: 1px solid #e1c7f7;">
                        <div style="display: flex; gap: 12px; margin-bottom: 10px;">
                            <div style="flex-shrink: 0;">
                                {% if event_story.image_url %}
                                    <img src="{{ event_story.image_url }}" alt="{{ event_story.title }}" 
                                         style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px; border: 2px solid #9c27b0;">
                                {% else %}
                                    <div class="event-thumbnail-placeholder" style="width: 80px; height: 60px; background: linear-gradient(135deg, #9c27b0, #8e24aa); border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.7rem; color: white; text-align: center; font-weight: 600;" 
                                         onclick="generateEventArticleImage({{ event_story.id }}, this)">
                                        üé™<br>AI
                                    </div>
                                {% endif %}
                            </div>
                            <div style="flex: 1;">
                                <div style="margin-bottom: 8px;">
                                    <span style="background: #9c27b0; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: 600;">
                                        {{ event_story.event_name }}
                                    </span>
                                    <span style="font-size: 0.75rem; color: #666; margin-left: 10px;">{{ event_story.published_date[:10] }}</span>
                                </div>
                                <h4 style="font-size: 0.95rem; font-weight: 600; line-height: 1.3; margin-bottom: 8px;">
                                    <a href="{{ event_story.url }}" target="_blank" style="color: #2c3e50; text-decoration: none;">{{ event_story.title }}</a>
                                </h4>
                                {% if event_story.description %}
                                    <p style="font-size: 0.8rem; color: #666; line-height: 1.4; margin-bottom: 10px;">{{ event_story.description[:120] }}{% if event_story.description|length > 120 %}...{% endif %}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 8px; justify-content: flex-end;">
                            <button onclick="shareArticle({{ event_story.id }})" class="btn" style="background: #9c27b0; font-size: 0.75rem; padding: 5px 10px;">üì§ Share</button>
                            <button onclick="addToDigest({{ event_story.id }})" class="btn" style="background: #ff6b35; font-size: 0.75rem; padding: 5px 10px;">üìã Digest</button>
                            <a href="{{ url_for('event_detail', event_id=event_story.event_id, view=view_mode) }}" class="btn" style="background: #3498db; font-size: 0.75rem; padding: 5px 10px; text-decoration: none; color: white;">üé™ Details</a>
                        </div>
                    </article>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        <!-- Additional Articles (if showing all) -->
        {% if stories|length > 12 %}
        <div id="more-stories" style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e1e5e9;">
            <h3 style="font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 25px; color: #000;">More Stories</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                {% for story in stories[12:] %}
                <article class="article-card">
                    <div class="article-meta">
                        {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                        <span class="feed-source" style="border-color: {{ color }};">
                            <span style="color: {{ color }};">{{ icon }}</span>
                            {{ story.feed_name }}
                        </span>
                        <span>{{ story.published_date[:10] }}</span>
                        <span class="relevance-score" style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %}">
                            {{ "%.0f"|format(story.relevance_score * 100) }}%
                        </span>
                        {% if story.event_name %}
                        <span class="event-coverage" style="background: #9c27b0; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px;">
                            <span>üé™</span>
                            <a href="{{ url_for('event_detail', event_id=story.event_id, view=view_mode) }}" style="color: white; text-decoration: none;">{{ story.event_name }}</a>
                        </span>
                        {% endif %}
                        {% if story.relevance_score < 0.3 %}
                            <span style="font-size: 0.7rem; color: #e74c3c;">‚ö†Ô∏è Low</span>
                        {% endif %}
                    </div>
                    <h3><a href="{{ story.url }}" target="_blank">{{ story.title }}</a></h3>
                    {% if story.description %}
                        <p>{{ story.description[:200] }}{% if story.description|length > 200 %}...{% endif %}</p>
                    {% endif %}
                    
                    {% if show_all and story.relevance_score < 0.5 %}
                    <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 8px; font-family: 'Inter', sans-serif;">
                        <strong>Why low relevance?</strong> 
                        {% if story.wifi_keywords %}
                            Found keywords: {{ story.wifi_keywords }}
                        {% elif story.relevance_score < 0.1 %}
                            No wireless technology keywords found.
                        {% elif story.relevance_score < 0.3 %}
                            Few wireless technology keywords detected.
                        {% else %}
                            Some wireless keywords found but not highly relevant.
                        {% endif %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
    {% else %}
        <div style="text-align: center; padding: 60px 20px; color: #7f8c8d; background: #f8f9fa; border-radius: 10px; border: 2px dashed #dee2e6;">
            <h3 style="font-family: 'Inter', sans-serif; font-size: 2rem; margin-bottom: 15px; color: #2c3e50;">üì° No Stories Available</h3>
            <p style="font-family: 'Inter', sans-serif; font-size: 1.1rem; margin-bottom: 25px;">
                {% if total_articles > 0 %}
                    Found {{ total_articles }} articles but none meet the relevance threshold. 
                    <a href="{{ url_for('index', view=view_mode, show_all='true') }}" style="color: #2980b9; text-decoration: underline;">Show all articles</a>
                {% else %}
                    Click "Fetch Now" to get the latest wireless technology news from your RSS feeds
                {% endif %}
            </p>
            <button onclick="fetchNow()" class="btn" style="font-size: 1.1rem; padding: 15px 30px;">üîÑ Fetch RSS Feeds</button>
        </div>
    {% endif %}

    <script>
    // Classic internet memes for loading animations
    const memeAnimations = [
        { class: 'badger-animation', emoji: 'ü¶°', name: 'Badger Badger Badger' },
        { class: 'nyan-animation', emoji: 'üåàüê±', name: 'Nyan Cat' },
        { class: 'keyboard-animation', emoji: 'üê±‚å®Ô∏è', name: 'Keyboard Cat' },
        { class: 'toaster-animation', emoji: 'üçû‚úàÔ∏è', name: 'Flying Toasters' }
    ];
    
    function getRandomMeme() {
        return memeAnimations[Math.floor(Math.random() * memeAnimations.length)];
    }
    
    // Auto-generate images on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üéâ Starting auto-image generation with classic memes!');
        
        // Find all image placeholders
        const placeholders = document.querySelectorAll('.image-loading-placeholder, .secondary-image-placeholder, .hero-image-placeholder');
        
        placeholders.forEach((placeholder, index) => {
            // Get article ID from various possible attributes
            let articleId = placeholder.getAttribute('data-article-id') || 
                           placeholder.getAttribute('onclick')?.match(/generateArticleImage\((\d+)/)?.[1] ||
                           placeholder.closest('article')?.querySelector('[onclick*="generateArticleImage"]')?.getAttribute('onclick')?.match(/\d+/)?.[0];
            
            if (articleId) {
                // Add random meme animation with delay for staggered effect
                setTimeout(() => {
                    const meme = getRandomMeme();
                    placeholder.className = `meme-animation ${meme.class}`;
                    placeholder.innerHTML = meme.emoji;
                    placeholder.title = `Loading... ${meme.name}`;
                    
                    console.log(`üé≠ Starting ${meme.name} animation for article ${articleId}`);
                    
                    // Start image generation
                    generateArticleImage(articleId, placeholder);
                }, index * 500); // Stagger animations by 500ms
            }
        });
    });

    async function generateArticleImage(articleId, placeholderElement) {
        // Determine if this is a thumbnail or full image
        const isThumbnail = placeholderElement.classList.contains('thumbnail-placeholder');
        
        // Update placeholder to show loading state
        if (isThumbnail) {
            placeholderElement.innerHTML = `‚è≥<br>Gen`;
            placeholderElement.style.background = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
        } else {
            placeholderElement.innerHTML = `
                <div style="text-align: center; color: #6c757d;">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">‚è≥</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Generating Image...</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Scraping article or creating AI image</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Estimated: 30-60 seconds</div>
                </div>
            `;
        }
        
        try {
            const response = await fetch(`/api/generate_article_image/${articleId}`, {
                method: 'POST'
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Replace placeholder with generated image
                if (isThumbnail) {
                    placeholderElement.outerHTML = `
                        <img src="${data.image_url}" alt="Article thumbnail" 
                             style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px;">
                    `;
                } else {
                    placeholderElement.outerHTML = `
                        <img src="${data.image_url}" alt="Article image" 
                             style="width: 100%; height: 300px; object-fit: cover; border-radius: 8px;">
                    `;
                }
                
                // Show success message briefly
                if (!isThumbnail) {
                    console.log(`‚úÖ Image generated for article ${articleId}: ${data.estimated_time}`);
                }
            } else {
                // Show error state
                if (isThumbnail) {
                    placeholderElement.innerHTML = `‚ùå<br>Err`;
                    placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
                } else {
                    placeholderElement.innerHTML = `
                        <div style="text-align: center; color: #dc3545;">
                            <div style="font-size: 2.5rem; margin-bottom: 10px;">‚ùå</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Generation Failed</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Could not scrape or generate image</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Click to retry</div>
                        </div>
                    `;
                }
            }
        } catch (error) {
            // Show error state
            if (isThumbnail) {
                placeholderElement.innerHTML = `‚ùå<br>Net`;
                placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
            } else {
                placeholderElement.innerHTML = `
                    <div style="text-align: center; color: #dc3545;">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">‚ùå</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Network Error</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Could not connect to image service</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Click to retry</div>
                    </div>
                `;
            }
        }
    }

    async function generateEventArticleImage(articleId, placeholderElement) {
        // Special function for event images to maintain proper sizing
        const originalWidth = placeholderElement.style.width;
        const originalHeight = placeholderElement.style.height;
        
        // Update placeholder to show loading state
        placeholderElement.innerHTML = `‚è≥<br>Gen`;
        placeholderElement.style.background = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
        
        try {
            const response = await fetch(`/api/generate_article_image/${articleId}`, {
                method: 'POST'
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Replace placeholder with generated image, maintaining exact dimensions
                placeholderElement.outerHTML = `
                    <img src="${data.image_url}" alt="Event article thumbnail" 
                         style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px; border: 2px solid #9c27b0;">
                `;
                
                console.log(`‚úÖ Event image generated for article ${articleId}: ${data.estimated_time}`);
            } else {
                // Show error state
                placeholderElement.innerHTML = `‚ùå<br>Err`;
                placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
            }
        } catch (error) {
            // Show error state
            placeholderElement.innerHTML = `‚ùå<br>Net`;
            placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
        }
    }

    async function fetchNow() {
        const statusDiv = document.getElementById('fetch-status');
        const button = event.target;
        
        button.disabled = true;
        button.textContent = '‚è≥ Fetching...';
        statusDiv.innerHTML = '<div class="alert alert-success">üì° Fetching RSS feeds, please wait...</div>';
        
        try {
            const response = await fetch('/api/fetch_now');
            const data = await response.json();
            
            if (data.success) {
                statusDiv.innerHTML = `<div class="alert alert-success">‚úÖ Successfully fetched ${data.fetched} new articles! Refreshing page...</div>`;
                setTimeout(() => location.reload(), 2000);
            } else {
                statusDiv.innerHTML = `<div class="alert alert-error">‚ùå Error: ${data.error}</div>`;
            }
        } catch (error) {
            statusDiv.innerHTML = `<div class="alert alert-error">‚ùå Network error: ${error.message}</div>`;
        } finally {
            button.disabled = false;
            button.textContent = 'üîÑ Fetch Now';
        }
    }
    </script>
{% endif %}
{% endblock %}