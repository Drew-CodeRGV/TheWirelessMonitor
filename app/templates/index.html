{% extends "base.html" %}

{% block title %}The Wireless Monitor - Today's Headlines{% endblock %}

{% block content %}
{% if view_mode == 'reader' %}
    <!-- Google Reader Style Three-Pane Layout -->
    <div class="reader-layout">
        <!-- Feeds Pane -->
        <div class="feeds-pane">
            <h3>üì° RSS Feeds</h3>
            <ul class="feed-list">
                <li class="feed-item active">All Items ({{ total_articles }})</li>
                <li class="feed-item">Starred Items</li>
                <li class="feed-item">Shared Items</li>
                <li class="feed-item">---</li>
                <li class="feed-item">Ars Technica</li>
                <li class="feed-item">TechCrunch</li>
                <li class="feed-item">The Verge</li>
                <li class="feed-item">IEEE Spectrum</li>
                <li class="feed-item">Fierce Wireless</li>
                <li class="feed-item">RCR Wireless</li>
            </ul>
        </div>
        
        <!-- Articles List Pane -->
        <div class="articles-pane">
            <h3>üì∞ Headlines ({{ stories|length }})</h3>
            {% if stories %}
                {% for story in stories %}
                <div class="article-list-item" onclick="selectArticle({{ loop.index0 }})">
                    <h4>{{ story.title }}</h4>
                    <div class="snippet">{{ (story.description[:120] + '...') if story.description and story.description|length > 120 else (story.description or 'No preview available') }}</div>
                    <div class="meta">
                        <span>{{ story.feed_name }}</span>
                        <span>{{ story.published_date[:10] }}</span>
                        {% if story.event_name %}
                        <span style="background: #9c27b0; color: white; padding: 1px 4px; border-radius: 4px; font-size: 0.6rem; font-weight: 600;">üé™ {{ story.event_name }}</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="padding: 40px 20px; text-align: center; color: #666;">
                    <p>No articles available</p>
                    <button onclick="fetchNow()" class="btn">üîÑ Fetch Now</button>
                </div>
            {% endif %}
        </div>
        
        <!-- Article Preview Pane -->
        <div class="article-preview">
            <div id="article-content">
                <h2>Select an article to preview</h2>
                <p style="color: #666; margin-top: 20px;">Click on any article from the list to see its full content here.</p>
            </div>
        </div>
    </div>
    
    <script>
        const articles = {{ stories|tojson }};
        
        function selectArticle(index) {
            // Remove previous selection
            document.querySelectorAll('.article-list-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            document.querySelectorAll('.article-list-item')[index].classList.add('selected');
            
            // Update preview pane
            const article = articles[index];
            const previewPane = document.getElementById('article-content');
            
            previewPane.innerHTML = `
                <h2>${article.title}</h2>
                <div class="preview-meta">
                    <strong>Source:</strong> ${article.feed_name} | 
                    <strong>Published:</strong> ${article.published_date.substring(0, 16)} | 
                    <strong>Relevance:</strong> ${Math.round(article.relevance_score * 100)}%
                </div>
                <div class="content">
                    ${article.content || article.description || 'No content available'}
                    <br><br>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button onclick="shareArticle(${article.id})" class="btn" style="background: #1da1f2; font-size: 0.85rem; padding: 6px 12px;">
                            üì§ Share
                        </button>
                        <button onclick="addToDigest(${article.id})" class="btn" style="background: #ff6b35; font-size: 0.85rem; padding: 6px 12px;">
                            üìã Add to Digest
                        </button>
                        <a href="${article.url}" target="_blank" class="btn">üìñ Read Full Article</a>
                    </div>
                </div>
            `;
        }
        
        async function fetchNow() {
            const button = event.target;
            button.disabled = true;
            button.textContent = '‚è≥ Fetching...';
            
            try {
                const response = await fetch('/api/fetch_now');
                const data = await response.json();
                
                if (data.success) {
                    setTimeout(() => location.reload(), 1000);
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Network error: ' + error.message);
            } finally {
                button.disabled = false;
                button.textContent = 'üîÑ Fetch Now';
            }
        }
    </script>

{% else %}
    <!-- NY Magazine Style Newspaper Layout -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px;">
        <h2>üì∞ Latest Wireless Technology Headlines</h2>
        <div style="display: flex; gap: 10px;">
            {% if not show_all and total_articles > relevant_articles %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" class="btn" style="background: #27ae60;">üìã Show All ({{ total_articles }})</a>
            {% elif show_all %}
                <a href="{{ url_for('index', view=view_mode) }}" class="btn" style="background: #f39c12;">üéØ Show Relevant Only ({{ relevant_articles }})</a>
            {% elif total_articles > 12 %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" class="btn" style="background: #27ae60;">üìã Show All ({{ total_articles }})</a>
            {% endif %}
            <button onclick="fetchNow()" class="btn">üîÑ Fetch Now</button>
        </div>
    </div>

    {% if show_all and stories %}
    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #f39c12;">
        <p style="font-family: 'Inter', sans-serif; font-size: 0.9rem; color: #856404; margin: 0;">
            <strong>üìã Showing all {{ stories|length }} articles from the last 5 days</strong> - including lower relevance items. 
            <a href="{{ url_for('index', view=view_mode) }}" style="color: #856404; text-decoration: underline;">Show relevant only ({{ relevant_articles }})</a>
        </p>
    </div>
    {% elif not show_all and stories %}
    <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #27ae60;">
        <p style="font-family: 'Inter', sans-serif; font-size: 0.9rem; color: #2d5a2d; margin: 0;">
            <strong>üéØ Showing {{ stories|length }} most relevant articles</strong> from the last 3-5 days. 
            {% if total_articles > relevant_articles %}
                <a href="{{ url_for('index', view=view_mode, show_all='true') }}" style="color: #2d5a2d; text-decoration: underline;">Show all {{ total_articles }} articles</a>
            {% endif %}
        </p>
    </div>
    {% endif %}

    <div id="fetch-status" style="margin-bottom: 25px;"></div>

    {% if stories %}
        <!-- NY Magazine Style Grid Layout -->
        <div class="articles-grid">
            <!-- Featured Article (First high-relevance article) -->
            {% set featured_article = stories[0] %}
            <article class="featured-article">
                <!-- Article Image -->
                <div class="article-image" style="margin-bottom: 15px;">
                    {% if featured_article.image_url %}
                        <img src="{{ featured_article.image_url }}" alt="{{ featured_article.title }}" 
                             style="width: 100%; height: 250px; object-fit: cover; border-radius: 8px;">
                    {% else %}
                        <div class="image-placeholder" style="width: 100%; height: 250px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 2px dashed #dee2e6; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-direction: column; cursor: pointer; transition: all 0.3s ease;" 
                             onclick="generateArticleImage({{ featured_article.id }}, this)"
                             onmouseover="this.style.background='linear-gradient(135deg, #e9ecef, #dee2e6)'"
                             onmouseout="this.style.background='linear-gradient(135deg, #f8f9fa, #e9ecef)'">
                            <div style="text-align: center; color: #6c757d;">
                                <div style="font-size: 2.5rem; margin-bottom: 10px;">üì∏</div>
                                <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600; margin-bottom: 5px;">Image Generation Underway</div>
                                <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-bottom: 8px;">Estimated time: 30-60 seconds</div>
                                <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; color: #adb5bd;">Click to start or check progress</div>
                            </div>
                        </div>
                    {% endif %}
                </div>
                
                <div class="article-meta">
                    {% set icon, color = get_feed_icon(featured_article.feed_name, featured_article.feed_url) %}
                    <span class="feed-source" style="border-color: {{ color }};">
                        <span style="color: {{ color }};">{{ icon }}</span>
                        {{ featured_article.feed_name }}
                    </span>
                    <span>{{ featured_article.published_date[:16] }}</span>
                    <span class="relevance-score" style="{% if featured_article.relevance_score < 0.3 %}background: #e74c3c;{% elif featured_article.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %}">
                        {{ "%.0f"|format(featured_article.relevance_score * 100) }}% Relevant
                    </span>
                    {% if featured_article.event_name %}
                    <span class="event-coverage" style="background: #9c27b0; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.7rem; font-weight: 600; display: inline-flex; align-items: center; gap: 4px;">
                        <span>üé™</span>
                        <a href="{{ url_for('event_detail', event_id=featured_article.event_id, view=view_mode) }}" style="color: white; text-decoration: none;">{{ featured_article.event_name }}</a>
                    </span>
                    {% endif %}
                </div>
                <h3><a href="{{ featured_article.url }}" target="_blank">{{ featured_article.title }}</a></h3>
                {% if featured_article.content and featured_article.content|length > 100 %}
                    <p>{{ featured_article.content[:300] }}{% if featured_article.content|length > 300 %}...{% endif %}</p>
                {% elif featured_article.description %}
                    <p>{{ featured_article.description[:250] }}{% if featured_article.description|length > 250 %}...{% endif %}</p>
                {% else %}
                    <p style="color: #7f8c8d; font-style: italic;">No content preview available</p>
                {% endif %}
                
                <!-- Social sharing and digest buttons -->
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button onclick="shareArticle({{ featured_article.id }})" class="btn" style="background: #1da1f2; font-size: 0.85rem; padding: 8px 16px;">
                        üì§ Share
                    </button>
                    <button onclick="addToDigest({{ featured_article.id }})" class="btn" style="background: #ff6b35; font-size: 0.85rem; padding: 8px 16px;">
                        üìã Add to Digest
                    </button>
                </div>
            </article>
            
            <!-- Secondary Articles Column 1 -->
            <div class="secondary-articles">
                {% for story in stories[1:4] %}
                <article class="article-card">
                    <!-- Article Thumbnail -->
                    <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                        <div style="flex-shrink: 0;">
                            {% if story.image_url %}
                                <img src="{{ story.image_url }}" alt="{{ story.title }}" 
                                     style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px;">
                            {% else %}
                                <div class="thumbnail-placeholder" style="width: 80px; height: 60px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 1px dashed #dee2e6; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.7rem; color: #6c757d; text-align: center;" 
                                     onclick="generateArticleImage({{ story.id }}, this)">
                                    üì∏<br>Gen
                                </div>
                            {% endif %}
                        </div>
                        <div style="flex: 1;">
                            <div class="article-meta">
                                {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                                <span class="feed-source" style="border-color: {{ color }};">
                                    <span style="color: {{ color }};">{{ icon }}</span>
                                    {{ story.feed_name }}
                                </span>
                                <span>{{ story.published_date[:10] }}</span>
                                <span class="relevance-score" style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %}">
                                    {{ "%.0f"|format(story.relevance_score * 100) }}%
                                </span>
                                {% if story.event_name %}
                                <span class="event-coverage" style="background: #9c27b0; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px;">
                                    <span>üé™</span>
                                    <a href="{{ url_for('event_detail', event_id=story.event_id, view=view_mode) }}" style="color: white; text-decoration: none;">{{ story.event_name }}</a>
                                </span>
                                {% endif %}
                            </div>
                            <h3><a href="{{ story.url }}" target="_blank">{{ story.title }}</a></h3>
                        </div>
                    </div>
                    {% if story.description %}
                        <p>{{ story.description[:150] }}{% if story.description|length > 150 %}...{% endif %}</p>
                    {% endif %}
                    
                    <!-- Social sharing and digest buttons -->
                    <div style="margin-top: 10px; display: flex; gap: 8px;">
                        <button onclick="shareArticle({{ story.id }})" class="btn" style="background: #1da1f2; font-size: 0.75rem; padding: 6px 12px;">
                            üì§ Share
                        </button>
                        <button onclick="addToDigest({{ story.id }})" class="btn" style="background: #ff6b35; font-size: 0.75rem; padding: 6px 12px;">
                            üìã Digest
                        </button>
                    </div>
                </article>
                {% endfor %}
            </div>
            
            <!-- Secondary Articles Column 2 -->
            <div class="secondary-articles">
                {% for story in stories[4:7] %}
                <article class="article-card">
                    <!-- Article Thumbnail -->
                    <div style="display: flex; gap: 15px; margin-bottom: 10px;">
                        <div style="flex-shrink: 0;">
                            {% if story.image_url %}
                                <img src="{{ story.image_url }}" alt="{{ story.title }}" 
                                     style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px;">
                            {% else %}
                                <div class="thumbnail-placeholder" style="width: 80px; height: 60px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border: 1px dashed #dee2e6; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.7rem; color: #6c757d; text-align: center;" 
                                     onclick="generateArticleImage({{ story.id }}, this)">
                                    üì∏<br>Gen
                                </div>
                            {% endif %}
                        </div>
                        <div style="flex: 1;">
                            <div class="article-meta">
                                {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                                <span class="feed-source" style="border-color: {{ color }};">
                                    <span style="color: {{ color }};">{{ icon }}</span>
                                    {{ story.feed_name }}
                                </span>
                                <span>{{ story.published_date[:10] }}</span>
                                <span class="relevance-score" style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %}">
                                    {{ "%.0f"|format(story.relevance_score * 100) }}%
                                </span>
                                {% if story.event_name %}
                                <span class="event-coverage" style="background: #9c27b0; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px;">
                                    <span>üé™</span>
                                    <a href="{{ url_for('event_detail', event_id=story.event_id, view=view_mode) }}" style="color: white; text-decoration: none;">{{ story.event_name }}</a>
                                </span>
                                {% endif %}
                            </div>
                            <h3><a href="{{ story.url }}" target="_blank">{{ story.title }}</a></h3>
                        </div>
                    </div>
                    {% if story.description %}
                        <p>{{ story.description[:150] }}{% if story.description|length > 150 %}...{% endif %}</p>
                    {% endif %}
                    
                    <!-- Social sharing and digest buttons -->
                    <div style="margin-top: 10px; display: flex; gap: 8px;">
                        <button onclick="shareArticle({{ story.id }})" class="btn" style="background: #1da1f2; font-size: 0.75rem; padding: 6px 12px;">
                            üì§ Share
                        </button>
                        <button onclick="addToDigest({{ story.id }})" class="btn" style="background: #ff6b35; font-size: 0.75rem; padding: 6px 12px;">
                            üìã Digest
                        </button>
                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
        
        <!-- Additional Articles (if showing all) -->
        {% if stories|length > 7 %}
        <div style="margin-top: 40px; padding-top: 30px; border-top: 2px solid #e1e5e9;">
            <h3 style="font-family: 'Playfair Display', serif; font-size: 1.8rem; margin-bottom: 25px; color: #000;">More Stories</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px;">
                {% for story in stories[7:] %}
                <article class="article-card">
                    <div class="article-meta">
                        {% set icon, color = get_feed_icon(story.feed_name, story.feed_url) %}
                        <span class="feed-source" style="border-color: {{ color }};">
                            <span style="color: {{ color }};">{{ icon }}</span>
                            {{ story.feed_name }}
                        </span>
                        <span>{{ story.published_date[:10] }}</span>
                        <span class="relevance-score" style="{% if story.relevance_score < 0.3 %}background: #e74c3c;{% elif story.relevance_score < 0.6 %}background: #f39c12;{% else %}background: #27ae60;{% endif %}">
                            {{ "%.0f"|format(story.relevance_score * 100) }}%
                        </span>
                        {% if story.event_name %}
                        <span class="event-coverage" style="background: #9c27b0; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; display: inline-flex; align-items: center; gap: 3px;">
                            <span>üé™</span>
                            <a href="{{ url_for('event_detail', event_id=story.event_id, view=view_mode) }}" style="color: white; text-decoration: none;">{{ story.event_name }}</a>
                        </span>
                        {% endif %}
                        {% if story.relevance_score < 0.3 %}
                            <span style="font-size: 0.7rem; color: #e74c3c;">‚ö†Ô∏è Low</span>
                        {% endif %}
                    </div>
                    <h3><a href="{{ story.url }}" target="_blank">{{ story.title }}</a></h3>
                    {% if story.description %}
                        <p>{{ story.description[:200] }}{% if story.description|length > 200 %}...{% endif %}</p>
                    {% endif %}
                    
                    {% if show_all and story.relevance_score < 0.5 %}
                    <div style="font-size: 0.8rem; color: #7f8c8d; margin-top: 8px; font-family: 'Inter', sans-serif;">
                        <strong>Why low relevance?</strong> 
                        {% if story.wifi_keywords %}
                            Found keywords: {{ story.wifi_keywords }}
                        {% elif story.relevance_score < 0.1 %}
                            No wireless technology keywords found.
                        {% elif story.relevance_score < 0.3 %}
                            Few wireless technology keywords detected.
                        {% else %}
                            Some wireless keywords found but not highly relevant.
                        {% endif %}
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
    {% else %}
        <div style="text-align: center; padding: 60px 20px; color: #7f8c8d; background: #f8f9fa; border-radius: 10px; border: 2px dashed #dee2e6;">
            <h3 style="font-family: 'Inter', sans-serif; font-size: 2rem; margin-bottom: 15px; color: #2c3e50;">üì° No Stories Available</h3>
            <p style="font-family: 'Inter', sans-serif; font-size: 1.1rem; margin-bottom: 25px;">
                {% if total_articles > 0 %}
                    Found {{ total_articles }} articles but none meet the relevance threshold. 
                    <a href="{{ url_for('index', view=view_mode, show_all='true') }}" style="color: #2980b9; text-decoration: underline;">Show all articles</a>
                {% else %}
                    Click "Fetch Now" to get the latest wireless technology news from your RSS feeds
                {% endif %}
            </p>
            <button onclick="fetchNow()" class="btn" style="font-size: 1.1rem; padding: 15px 30px;">üîÑ Fetch RSS Feeds</button>
        </div>
    {% endif %}

    <script>
    async function generateArticleImage(articleId, placeholderElement) {
        // Determine if this is a thumbnail or full image
        const isThumbnail = placeholderElement.classList.contains('thumbnail-placeholder');
        
        // Update placeholder to show loading state
        if (isThumbnail) {
            placeholderElement.innerHTML = `‚è≥<br>Gen`;
            placeholderElement.style.background = 'linear-gradient(135deg, #fff3cd, #ffeaa7)';
        } else {
            placeholderElement.innerHTML = `
                <div style="text-align: center; color: #6c757d;">
                    <div style="font-size: 2.5rem; margin-bottom: 10px;">‚è≥</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Generating Image...</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Scraping article or creating AI image</div>
                    <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Estimated: 30-60 seconds</div>
                </div>
            `;
        }
        
        try {
            const response = await fetch(`/api/generate_article_image/${articleId}`, {
                method: 'POST'
            });
            
            const data = await response.json();
            
            if (data.success) {
                // Replace placeholder with generated image
                if (isThumbnail) {
                    placeholderElement.outerHTML = `
                        <img src="${data.image_url}" alt="Article thumbnail" 
                             style="width: 80px; height: 60px; object-fit: cover; border-radius: 6px;">
                    `;
                } else {
                    placeholderElement.outerHTML = `
                        <img src="${data.image_url}" alt="Article image" 
                             style="width: 100%; height: 250px; object-fit: cover; border-radius: 8px;">
                    `;
                }
                
                // Show success message briefly
                if (!isThumbnail) {
                    console.log(`‚úÖ Image generated for article ${articleId}: ${data.estimated_time}`);
                }
            } else {
                // Show error state
                if (isThumbnail) {
                    placeholderElement.innerHTML = `‚ùå<br>Err`;
                    placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
                } else {
                    placeholderElement.innerHTML = `
                        <div style="text-align: center; color: #dc3545;">
                            <div style="font-size: 2.5rem; margin-bottom: 10px;">‚ùå</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Generation Failed</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Could not scrape or generate image</div>
                            <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Click to retry</div>
                        </div>
                    `;
                }
            }
        } catch (error) {
            // Show error state
            if (isThumbnail) {
                placeholderElement.innerHTML = `‚ùå<br>Net`;
                placeholderElement.style.background = 'linear-gradient(135deg, #f8d7da, #f5c6cb)';
            } else {
                placeholderElement.innerHTML = `
                    <div style="text-align: center; color: #dc3545;">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">‚ùå</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 1rem; font-weight: 600;">Network Error</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.85rem; margin-top: 5px;">Could not connect to image service</div>
                        <div style="font-family: 'Inter', sans-serif; font-size: 0.8rem; margin-top: 8px; color: #adb5bd;">Click to retry</div>
                    </div>
                `;
            }
        }
    }

    async function fetchNow() {
        const statusDiv = document.getElementById('fetch-status');
        const button = event.target;
        
        button.disabled = true;
        button.textContent = '‚è≥ Fetching...';
        statusDiv.innerHTML = '<div class="alert alert-success">üì° Fetching RSS feeds, please wait...</div>';
        
        try {
            const response = await fetch('/api/fetch_now');
            const data = await response.json();
            
            if (data.success) {
                statusDiv.innerHTML = `<div class="alert alert-success">‚úÖ Successfully fetched ${data.fetched} new articles! Refreshing page...</div>`;
                setTimeout(() => location.reload(), 2000);
            } else {
                statusDiv.innerHTML = `<div class="alert alert-error">‚ùå Error: ${data.error}</div>`;
            }
        } catch (error) {
            statusDiv.innerHTML = `<div class="alert alert-error">‚ùå Network error: ${error.message}</div>`;
        } finally {
            button.disabled = false;
            button.textContent = 'üîÑ Fetch Now';
        }
    }
    </script>
{% endif %}
{% endblock %}